[uwsgi]
# Django WSGI module
module = samaanai.wsgi:application

# Master process
master = true

# Number of worker processes for production
processes = 4

# Number of threads per worker
threads = 2

# Socket and protocol
http = :$(PORT)
protocol = http

# Optimize for Cloud Run
# Disable request logging for performance (Cloud Run handles this)
disable-logging = false
log-4xx = true
log-5xx = true

# Timeouts
harakiri = 300
socket-timeout = 300
http-timeout = 300

# Memory optimizations
vacuum = true
max-requests = 1000
max-requests-delta = 100

# Enable threading
enable-threads = true

# Cheaper mode for dynamic scaling (good for Cloud Run)
cheaper-algo = busyness
cheaper = 2
cheaper-initial = 2
cheaper-step = 1

# Buffer size
buffer-size = 32768

# Logging
logto = /dev/stdout
log-date = true

# Graceful shutdown
die-on-term = true

# Python auto-reload (disable in production)
py-autoreload = 0

# Lazy apps mode - each worker loads the app independently
# This avoids the issues we saw with gunicorn
lazy-apps = true
